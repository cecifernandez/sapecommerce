<mvc:View
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    controllerName="ui5.starwarsecommerce.controller.ProductDetail"
>
    <core:Fragment
        fragmentName="ui5.starwarsecommerce.view.fragments.Toolbar"
        type="XML"
    />

    <Page
        id="productDetailPage"
        showHeader="false"
        class="prod-detail"
    >
        <content>
            <FlexBox
                id="productDetailContainer"
                class="sapUiSmallMargin productDetailContainer sapUiMediumMarginTop"
                wrap="Wrap"
                direction="Row"
                alignItems="Start"
            >
                <!-- Imagen del producto -->
                <VBox
                    id="productCarouselBox"
                    class="productCarouselBox"
                >
                    <Carousel
                        id="productImageCarousel"
                        pages="{productDetail>/images}"
                        loop="true"
                        showPageIndicator="true"
                        pageIndicatorPlacement="Bottom"
                    >
                        <Image
                            id="productCarouselImage"
                            src="{productDetail>}"
                        />
                    </Carousel>
                </VBox>

                <!-- Detalles del producto -->
                <VBox
                    id="productDetailsBox"
                    class="productDetailsBox sapUiSmallMarginBottom sapUiMediumMarginTop"
                >
                    <Title
                        id="productName"
                        text="{productDetail>/name}"
                        level="H1"
                    />
                    <Text
                        id="productDescription"
                        text="{productDetail>/description}"
                        wrapping="true"
                    />
                    <Title
                        id="productPrice"
                        text="{= ${i18n>priceLabel} + ' ' + ${productDetail>/price} }"
                        level="H2"
                    />
                    <RatingIndicator
                        id="productRatingIndicator"
                        value="{viewModel>/reviewRating}"
                        maxValue="5"
                        enabled="true"
                        iconSize="2rem"
                        class="sapUiTinyMarginBegin"
                    />
                    <HBox
                        id="productActions"
                        alignItems="Center"
                        class="sapUiSmallMarginTop"
                    >
                        <Button
                            id="addToCartButton"
                            text="{i18n>addToCart}"
                            press=".onAddToCart"
                            class="sapUiSmallMarginEnd"
                        />
                        <Button
                            id="toggleFavoriteButton"
                            icon="{= ${productDetail>/isFavorite} ? 'sap-icon://heart' : 'sap-icon://heart-2'}"
                            type="Transparent"
                            press=".onToggleFavorite"
                            tooltip="{i18n>addToFavorites}"
                        />
                    </HBox>
                    <Label
                        id="variantLabel"
                        text="{i18n>variantLabel}"
                    />
                    <Select
                        id="variantSelect"
                        items="{productDetail>/variants}"
                        selectedKey="{productDetail>/selectedVariant}"
                        change=".onVariantChange"
                    >
                        <core:Item
                            key="{productDetail>name}"
                            text="{productDetail>name}"
                            id="variantItem"
                        />
                    </Select>
                </VBox>
            </FlexBox>

            <!-- Reseñas del producto -->
            <VBox
                id="productReviewsBox"
                class="sapUiSmallMarginTop sapUiMediumMarginBegin"
            >
                <Title
                    id="reviewsTitle"
                    text="{i18n>reviews}"
                    level="H2"
                />
                <List
                    id="reviewsList"
                    items="{productDetail>/reviews}"
                    class="sapUiResponsiveMargin"
                >
                    <CustomListItem id="reviewItemList">
                        <VBox
                            class="sapUiSmallMarginBottom sapUiTinyMarginTop"
                            id="reviewItemVBox"
                        >
                            <HBox
                                alignItems="Center"
                                id="reviewItemHBox"
                            >
                                <Avatar
                                    id="reviewAvatar"
                                    src="{productDetail>avatar}"
                                    displaySize="S"
                                    class="sapUiSmallMarginEnd"
                                />
                                <Title
                                    id="reviewUsername"
                                    text="{productDetail>username}"
                                    level="H3"
                                />
                                <RatingIndicator
                                    id="reviewRating"
                                    value="{productDetail>rating}"
                                    maxValue="5"
                                    enabled="false"
                                    iconSize="1rem"
                                    class="sapUiSmallMarginBegin"
                                />
                            </HBox>
                            <Text
                                id="reviewComment"
                                text="{productDetail>comment}"
                                wrapping="true"
                                class="sapUiTinyMarginTop"
                            />
                        </VBox>
                    </CustomListItem>
                </List>
            </VBox>

            <!-- Tus Reseñas -->
            <VBox
                id="userReviewsBox"
                class="sapUiSmallMarginTop sapUiMediumMarginBegin"
            >
                <Title
                    id="yourReviewsTitle"
                    text="{i18n>yourReviews}"
                    level="H2"
                />
                <List
                    id="yourReviewsList"
                    items="{path: 'userModel>/filteredUserReviews'}"
                    class="sapUiResponsiveMargin"
                >
                    <CustomListItem id="userReviewItemList">
                        <VBox class="sapUiSmallMarginBottom sapUiTinyMarginTop" id="userReviewItemVBox">
                            <HBox alignItems="Center" id="userReviewItemHBox">
                                <Avatar
                                    id="userReviewAvatar"
                                    src="{userModel>/avatar}"
                                    displaySize="S"
                                    class="sapUiSmallMarginEnd"
                                />
                                <Title
                                    id="userReviewName"
                                    text="{userModel>user}"
                                    level="H3"
                                />
                                <RatingIndicator
                                    id="userReviewRating"
                                    value="{userModel>rating}"
                                    maxValue="5"
                                    enabled="false"
                                    iconSize="1rem"
                                    class="sapUiSmallMarginBegin"
                                />
                            </HBox>
                            <Text
                                id="userReviewComment"
                                text="{userModel>text}"
                                wrapping="true"
                                class="sapUiTinyMarginTop"
                            />
                        </VBox>
                    </CustomListItem>
                </List>
            </VBox>

            <!-- Escribir nueva reseña -->
            <VBox
                id="writeReviewBox"
                class="sapUiMediumMarginBegin sapUiLargeMarginBottom"
            >
                <Text
                    id="writeReviewPrompt"
                    text="{i18n>writeReview}"
                />
                <TextArea
                    id="reviewTextArea"
                    value="{viewModel>/reviewText}"
                    rows="4"
                    width="100%"
                    placeholder="{i18n>reviewPlaceholder}"
                />
                <Button
                    id="submitReviewButton"
                    text="{i18n>submitReview}"
                    press=".onPostReview"
                />
            </VBox>
        </content>
        <footer>
            <core:Fragment
                fragmentName="ui5.starwarsecommerce.view.fragments.Footer"
                type="XML"
            />
        </footer>
    </Page>
</mvc:View>
